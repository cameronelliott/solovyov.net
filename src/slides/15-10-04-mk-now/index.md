class: middle
background-image: url(img/title-slide.png)

<br/>
# –ö–∞–∫ modnaKasta —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª–∞—Å—å

.meta[–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –°–æ–ª–æ–≤—å√´–≤, CTO modnaKasta]

???

- –®–æ–ø–ø–∏–Ω–≥-–∫–ª—É–±
- –ë–æ–ª–µ–µ –ø–æ–ª—É–≥–æ–¥–∞ CTO
- –ö—É—á–∞ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π

---

<img src="img/mk.jpg"/>

- 750 RPS
- 3-6k –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ —Å–∞–π—Ç–µ –¥–Ω√´–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–ø–æ –≤–µ—Ä—Å–∏–∏ GA)
- 120 Gb —Ä–∞–∑–º–µ—Ä –±–∞–∑—ã
- ~80-100k —Å—Ç—Ä–æ–∫ Python'–∞

???

- –≠—Ç–æ –≤ –ø–∏–∫–µ, 30 —Å–µ–Ω—Ç—è–±—Ä—è, 1 –∞–ø—Ä–µ–ª—è
- –ù–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö 110-130 RPS
- –ö–æ–¥–∞ —É–∂–µ –º–µ–Ω—å—à–µ

---

class: center, middle

# –ú–Ω–æ–≥–æ –ª–∏ —ç—Ç–æ?

## –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–± —É–º–∏—Ä–∞—Ç—å –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏

???

- –ù—É —Ç.–µ. –æ—Ç –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ –º–Ω–æ–≥–æ–µ –∑–∞–≤–∏—Å–∏—Ç
- –°–µ–π—á–∞—Å —Ä–∞—Å—Å–∫–∞–∂—É, –∫–∞–∫ –æ–Ω–æ –±—ã–ª–æ

---

# –ö–∞–∫ –æ–Ω–æ –±—ã–ª–æ

.center.middle[![old](1-mk-old-arch.png)]

???

- –ü—ñ—Ç–æ–Ω —É —à–∞–ø—Ü—ñ —Ç–∞ —ó—Å—Ç—å –ª–∏—Å—Ç–∏–∫, —â–æ —Å–∏–º–≤–æ–ª—ñ–∑—É—î –ø—Ä–∞—Ü–µ–ª—é–±–Ω—ñ—Å—Ç—å —Ç–∞ –Ω–µ–∑–∞–∫–æ–º–ø–ª–µ–∫—Å–æ–≤–∞–Ω—ñ—Å—Ç—å —Ç–≤–∞—Ä—é–∫–∏
- –í—Å–µ —Å–æ –≤—Å–µ–º–∏
- –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —Å–ª–æ–∂–Ω–µ–µ, –≤ MK - –µ—â–µ ktdb (email, –∑–∞–¥–∞—á–∏) –∏ –±–∞–Ω–Ω–µ—Ä—ã

---

# –ú–µ—Ç–∞–¥–∞—Ç–∞–ø–∞—Ä—ã

.center.middle[<img src="2-mdp.png" style="height: 500px"/>]

???

- –°–ª–æ–≤–æ-–Ω–∞—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ
- –û–±—ã—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è KV-–¥–∞–Ω–Ω—ã—Ö

---

# –ò –≤ –Ω–∏—Ö —É –Ω–∞—Å —Ö—Ä–∞–Ω–∏—Ç—Å—è...

```sql
=# SELECT k.key, k.id, COUNT(p.id)
-# FROM product_metadatapair p
-# JOIN product_metadatakey k ON p.key_id = k.id
-# GROUP BY k.key, k.id
-# ORDER BY COUNT(p.id);
   key    | id |  count
----------+----+----------
 –û–±—ä–µ–º    | 18 |       26
          |  3 |       27
 –û–ø–∏—Å–∞–Ω–∏–µ | 17 |      176
 –ù–æ–º–µ—Ä    |  2 |      443
 P–∞–∑–º–µ—Ä   |  1 |     3112
 –†–∞–∑–º–µ—Ä   | 16 | 15212192
(6 rows)
```

???

- –ü–æ –ø—É—Å—Ç–æ–º—É –∫–ª—é—á—É - –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –ü–µ—Ä–≤–∞—è –±—É–∫–≤–∞ –ø–µ—Ä–≤–æ–≥–æ "—Ä–∞–∑–º–µ—Ä" - –∞–Ω–≥–ª–∏–π—Å–∫–∞—è –ø

---

# –ò –Ω–∞–ª–∏—á–∏–µ...

.center.middle[<img src="3-mdp-stock.png" style="height: 500px"/>]

???

- –Ø –±—ã –æ–∂–∏–¥–∞–ª —Å—Ç–æ–∫ –∫–∞–∫ –æ–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–π –≤ MDP
- –ê –ø–æ—á–µ–º—É m2m?
- –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ, 1 MDP - —ç—Ç–æ 1 —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–≤–∞—Ä

---

# –ò –∫–æ—Ä–∑–∏–Ω–∞!

.center.middle[<img src="4-mdp-bi.png" style="height: 500px"/>]

???

- 25 –º–ª–Ω –∑–∞–ø–∏—Å–µ–π –≤ basket item
- 1 BI - 1 —Ç–æ–≤–∞—Ä, –∞ —É –Ω–∞—Å –æ–ø—è—Ç—å m2m

---

# Problems?

- 22 –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ 1 —Ä–∞–∑–º–µ—Ä

--

- 110 –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ 5 —Ä–∞–∑–º–µ—Ä–æ–≤

--

- –≠—Ç–æ –∏—Å–ø—Ä–∞–≤–∏–ª–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º

--

background-image: url(img/facepalm.png)

- –ö–æ—Ç–æ—Ä–æ–µ –∑–∞–≤—è–∑–∞–Ω–æ –Ω–∞ –∫–æ—Ä–∑–∏–Ω—É, –ø–æ—ç—Ç–æ–º—É –∫–µ—à–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —é–∑–µ—Ä–∞ –æ—Ç–¥–µ–ª—å–Ω–æ

---

# –ê –∫–∞–∫ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å?

.center.middle[<img src="5-sku.png" style="height: 500px"/>]

???

- –ù–∏–∫–∞–∫–∏—Ö m2m, –≥–¥–µ –Ω–µ –Ω–∞–¥–æ

---

# –ê –µ—â–µ –∑–∞–∫–∞–∑—ã

- –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –Ω–∞ –≤—Ö–æ–¥–µ –≤ –∫–æ—Ä–∑–∏–Ω—É
- Payment'—ã —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –ø—Ä–∏ –≤—ã–±–æ—Ä–µ, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É–¥–∞–ª—è–ª–∏—Å—å
- –ü—É—Å—Ç—ã—Ö –Ω–µ–æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –≤ –±–∞–∑–µ –º–∏–ª–ª–∏–æ–Ω—ã
- –ö–æ—Ä–∑–∏–Ω–∞ –Ω–µ —Å–∏–Ω–≥–ª—Ç–æ–Ω, –Ω–∞–π—Ç–∏ —Ç–µ–∫—É—â—É—é - –ø—Ä–æ–±–ª–µ–º–∞

---

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è!

```diff
commit f2c3eaa1e0747075c005d74094a5391b51498cf6
Author: v.ishchenko <v.ishchenko@modnakasta.ua>
Date:   Thu Feb 5 17:56:09 2015 +0200

    Fix password reset send letter

diff --git a/user/urls.py b/urls.py
@@ -166 +166 @@

-    url(r'^reset/(?P<confirm>[A-Za-z0-9\-]+)/$',
+    url(r'^reset/(?P<confirm>[^/]+)/$',
```

---

# –ò –æ—Å—Ç–∞–ª—å–Ω–æ–µ

- –ú–∏–≥—Ä–∞—Ü–∏–π –Ω–µ—Ç
- –†–∞–∑–º–µ—Ä–Ω—ã–µ —Å–µ—Ç–∫–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏
- –ë–∞–Ω–Ω–µ—Ä–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞ KyotoDB/Lua/Python/JS
- –ü–æ—á—Ç–æ–≤–∞—è –æ—á–µ—Ä–µ–¥—å –Ω–∞ KyotoDB –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ –æ—Ç–¥–µ–ª—å–Ω–æ

---

background-image: url(img/trollface.png)

# –ü—Ä–∏ —á√´–º –∑–¥–µ—Å—å —Ñ—Ä–æ–Ω—Ç—ç–Ω–¥

--

background-image: ""

# .center.middle.invert[–ß√´—Ä–Ω–∞—è<br/>–ø—è—Ç–Ω–∏—Ü–∞]

---

# –¢–µ–ø–µ—Ä—å

.center.middle[![new](6-mk-new-arch.png)]

---

# –ß—Ç–æ —Ç–∞–º —É –Ω–∞—Å

- React
- ClojureScript
- Datascript
- Javelin

---

# React
## –ù—É –∫–∞–∫–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã?

---

# ClojureScript
## worth repeating

- –õ–∏—Å–ø
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –≤ JS
- –ú–∏–Ω–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –≤ advanced —Ä–µ–∂–∏–º–µ Closure Compiler

---

# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

.center.middle[<img src="7-frontend-arch.png" style="width: 100%"/>]

---

.center[<img src="img/datascript.png" style="width: 100%"/>]

- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏
- –Ø–∑—ã–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ Datalog
- –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è: —Ç—Ä–∏–ø–ª–µ—Ç—ã
- –°—Å—ã–ª–∫–∏, –¥–∂–æ–π–Ω—ã, –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

---

# –ü–æ–ª—É—á–∏—Ç—å –∏–∑ –±–∞–∑—ã –±–∞–Ω–Ω–µ—Ä—ã

.big[```clojure
(d/q db

  '[:in $ ?contains-now?
    :find ?e
    :where
      [?e :banner/id]
      [?e :starts-at ?start]
      [?e :finishes-at ?finish]
      [(?contains-now? ?start ?finish)]]

  (fn [start finish]
    (time/within?
      start finish (time/now))))
```]

---

# –ü—Ä–∏–º–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

```clojure
(rum/defc Banners < rum/reactive
  [id]
  (let [all-banners (rum/react BANNERS)
        banners (get all-banners id)]
    [:div {:class "banners"}
      (for [banner banners]
        [:img {:src banner
               :data-banner-id id}])]))
```

- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `Banners`
- –ê—Ä–≥—É–º–µ–Ω—Ç - `id`, —Ä–∏—Å—É–µ—Ç –±–∞–Ω–Ω–µ—Ä–∞ –¥–ª—è —ç—Ç–æ–≥–æ –º–µ—Å—Ç–∞
- –†–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —è—á–µ–π–∫—É `BANNERS`
- –†–∏—Å—É–µ—Ç —Å–ø–∏—Å–æ–∫ –±–∞–Ω–Ω–µ—Ä–æ–≤

---

# –°–µ—Ä–≤–µ—Ä–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥

```clj
(defn handler [req res]
  (.writeHead res 200 {"Content-Type" "text/html"})
  (main/render-to-string
    (.-url req)
    (fn [initial content]
      (.end res (render-template initial content)))))

(def app (.createServer http handler))
(.listen app 6000 "0.0.0.0")
```

- `render-to-string` - —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç —Ä–µ–∞–∫—Ç-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Å—Ç—Ä–æ–∫—É
- –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã–µ –æ—Ç–¥–∞—é—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç

---

# –í–µ—Å—å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥

```clj
(defn render-to-string [url callback]
  (router/set-route url)

  (let [comp (router/Root data/db)]
    ;; –û—Ç—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å 1 —Ä–∞–∑, —á—Ç–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç—å AJAX-–∑–∞–ø—Ä–æ—Å—ã
    (js/React.renderToString comp)

    ;; –ñ–¥√´–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
    (add-watch xhr/current-queries ::render
      (fn [_ _ _ value]
        (when (zero? (get-xhr-request-count))
          (callback db (js/React.renderToString comp)))))))
```

- `get-xhr-request-count` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ "–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ"

---

# –ò —á—Ç–æ, —É–¥–æ–±–Ω–æ?

- React –∂–µ :-)
- Live reload –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- Live reload –µ—Å—Ç—å –∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç—Ç–æ —Å—á–∞—Å—Ç—å–µ (paredit)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ –º–µ–Ω—å—à–µ, —á–µ–º –Ω–∞ JS
- –®–∞—Ä–∏–Ω–≥ –∫–æ–¥–∞ –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–æ–º –∏ –∫–ª–∏–µ–Ω—Ç–æ–º üëç
- Tooling –≤–æ–∫—Ä—É–≥ –æ—á–µ–Ω—å –∫—Ä—É—Ç–æ–π

???

- Live reload —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ –∏–∑-–∑–∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π CLJS

---

class: center, middle

<style>
h1#-map-answer { margin-left: -7em; }
h1#-some-good-questions- { margin-top: -0.7em;}
</style>

# (map answer
# (some good? questions))
