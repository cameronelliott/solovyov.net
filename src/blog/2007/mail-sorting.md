title: Сортировка почты
date: 2007-12-04 20:32:13
tags: nix, python, mail
----


Настраивал себе локально чтение почты (кое-какие потоки почты забираю вместо перенаправления на гмейл, проще жить выходит :-), ну и сортировку соответственно. Так как я не слишком люблю клиенты типа Тандербёрда или Сильфид, то основным способ у меня всегда был procmail. Но его правила порядочно раздражают: читаешь доки, читаешь, проходит три месяца - и всё забывается. :-) Ещё, пока читал почту Gnus'ом, фильтровал его внутренними правилами, которые конечно поинтереснее прокмейловых, но... привязаны к Гнусу.

Потому я решил поискать для себя что-то стороннее, но поинтереснее прокмейла. maildrop, имя которого раньше неоднократно встречал, не впечатлил синтаксисом. Промелькнула даже шальная мысль попробовать раскидывать почту правилами Exim'а, но это было бы ничуть не более портабельное решение, чем правила Гнуса. 

Пересмотрел порядка десятка программ и наткнулся на очень интересную штуку - [maildirproc][1]. Самое большое её достоинство: она написана на питоне и правила раскидывания - тоже самый обычный питон, можно творить всё, что душе угодно. Кроме того, есть одна особенность - в отличии от MDA типа procmail'а и maildrop'а, эта штука ориентирована сугубо на сортировку почты для одного человека. Потому просто указывается место, где появляется почта (типа `/var/mail/piranha`), и программа делает с каждым пришедшим письмом разные непотребности в полном соответствии правилам (есть однократный запуск, когда раскидывается вся текущая почта, и постоянный, когда "почтовые места" проверяются ежесекундно).

Работает всё очень просто - программа входит в бесконечную итерацию, в каждый проход которой существует объект письма, над которым можно поиздеваться. Пример настройки можно посмотреть [тут][2] (совсем простой вариант, но там рядом есть ещё несколько вплоть до совершенного хардкора), все возможности можно увидеть [здесь][3].

[1]: http://joel.rosdahl.net/maildirproc/ "Питон и тут рулит :-)"
[2]: http://joel.rosdahl.net/maildirproc/examples/simple.rc "Простой до отупения, зато всё ясно"
[3]: http://joel.rosdahl.net/maildirproc/reference.html "Доки мало, ибо больше и не нужно"
